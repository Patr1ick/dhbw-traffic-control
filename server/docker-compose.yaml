version: "3.8"
services:
    server:
        build: .
        container_name: server
        environment:
            - DATABASE_ADDRESS=10.5.0.6
        ports:
            - 8080:8080
        networks:
            net:
                ipv4_address: 10.5.0.5
        depends_on:
            - db
        restart: always

    db-master:
        image: yugabytedb/yugabyte:latest
        container_name: db
        command: >
            ./bin/yb-master \
            --master_addresses 192.168.178.46:7100,192.168.178.47:7100,192.168.178.48:7100 \
            --rpc_bind_addresses 192.168.178.46 \
            --fs_data_dirs "/home/centos/disk1,/home/centos/disk2" \
            --replication_factor=3
        environment:
            - YCQL_USER=cassandra
            - YCQL_PASSWORD=cassandra
        ports:
            - 7000:7000
            - 7100:7100
            - 9042:9042
        networks:
            net:
                ipv4_address: 10.5.0.6

    db-tserver:
        image: yugabytedb/yugabyte:latest
        container_name: db
        command: >
            ./bin/yb-tserver \
            --tserver_master_addrs 192.168.178.46:7100,192.168.178.47:7100,192.168.178.48:7100 \
            --rpc_bind_addresses 192.168.178.46 \
            --placement_zone node1 \
            --fs_data_dirs "/home/centos/disk1,/home/centos/disk2" &
        environment:
            - YCQL_USER=cassandra
            - YCQL_PASSWORD=cassandra
        ports:
            - 9000:9000
            - 9100:9100
            - 9042:9042
        networks:
            net:
                ipv4_address: 10.5.0.6

networks:
    net:
        driver: bridge
        ipam:
            config:
                - subnet: 10.5.0.0/16
                  gateway: 10.5.0.1
