version: "3.8"
services:
    server:
        build: .
        container_name: server
        environment:
            - CASSANDRA_ADDRESS=10.5.0.6
        ports:
            - 8080:8080
        networks:
            net:
                ipv4_address: 10.5.0.5
        depends_on:
            - db
        restart: always

    db:
        image: cassandra:latest
        container_name: db
        environment:
            - CASSANDRA_USER=cassandra
            - CASSANDRA_PASSWORD=cassandra
            - CASSANDRA_PASSWORD_SEEDER=yes
            - CASSANDRA_SEEDS=192.168.178.48,192.168.178.49
            - CASSANDRA_BROADCAST_ADDRESS=192.168.178.47
        networks:
            net:
                ipv4_address: 10.5.0.6
        ports:
            - 9042:9042
            - 7000:7000
        healthcheck:
            test:
                [
                    "CMD",
                    "cqlsh",
                    "10.5.0.6",
                    "-u cassandra",
                    "-p cassandra",
                    "-e describe keyspaces",
                ]
            interval: 15s
            timeout: 10s
            retries: 10

networks:
    net:
        driver: bridge
        ipam:
            config:
                - subnet: 10.5.0.0/16
                  gateway: 10.5.0.1
